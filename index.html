<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Music Blocks</title>
    <meta name="description" content="Learn to code through music with Music Blocks. Arrange colorful blocks to create everything from simple melodies to interactive games.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">

    <!-- Icons & PWA -->
    <link rel="icon" sizes="192x192" href="favicon.ico">
    <link rel="apple-touch-icon" href="/activity/activity-icon-color-512.png">
    <link rel="manifest" href="android_chrome_manifest.json">

    <!-- Stylesheets & Preloads -->
    <link rel="preload" href="https://fonts.googleapis.com/icon?family=Material+Icons" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="fonts/material-icons.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="fonts/material-icons.css">
    <link rel="preload" href="css/activities.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="css/activities.css">
    <link rel="preload" href="dist/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="dist/css/style.css">
    <link rel="stylesheet" href="dist/css/keyboard.css">
    <link rel="stylesheet" href="dist/css/windows.css">
    <link rel="stylesheet" href="lib/materialize-iso.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/darkmode.css">
    <link rel="prefetch" type="application/l10n" href="./localization.ini">

    <!-- Preload media -->
    <link rel="preload" as="video" href="loading-animation.webm" type="video/webm">
    <link rel="preload" as="video" href="loading-animation.mp4" type="video/mp4">
    <link rel="preload" as="image" href="loading-animation-ja.svg">

    

    <!-- Deferred scripts -->
    <script src="lib/reqwest.js" defer></script>
    <script src="lib/jquery-2.1.4.min.js" defer></script>
    <script src="lib/jquery-ui.js" defer></script>
    <script src="lib/materialize.min.js" defer></script>
    <script src="lib/webL10n.js" defer></script>
    <script src="lib/Tone.js" defer></script>
    <script src="lib/midi.js" defer></script>
    <script src="lib/jquery.ruler.js" defer></script>
    <script src="lib/modernizr-2.6.2.min.js" defer></script>
    <script src="lib/raphael.min.js" defer></script>
    <script src="lib/wheelnav.js" defer></script>
    <script src="lib/abc.min.js" defer></script>
    <script src="lib/codejar/codejar.min.js" defer></script>
    <script src="lib/codejar/highlight.pack.js" defer></script>
    <script src="lib/astring.min.js" defer></script>
    <script data-main="js/loader" src="lib/require.js" defer></script>
    <script src="lib/easeljs.min.js" defer></script>
    <script src="lib/tweenjs.min.js" defer></script>
</head>

<body id="body" onload="init();" style="background: #f9f9f9;">
    <noscript>JavaScript is required to view this page.</noscript>
    <!-- Hidden controls -->
    <div id="chooseKeyDiv" style="display: none;" tabindex="-1"></div>
    <div id="movable" tabindex="-1">
        <p>Solfege Pitch Preview</p>
        <label><input class="radioBtn" type="radio" name="movable" value="true"> Movable Do</label>
        <label><input class="radioBtn" type="radio" name="movable" value="false" checked> Fixed</label>
    </div>

    <!-- Loading screen -->
    <div id="loading-image-container" style="position: fixed; top:0; left:0; width:100%; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; background-color:#FFFFFF; z-index:9999;">
        <div id="loading-media" style="width:100%; padding:0 20px; box-sizing:border-box;"></div>
        <div id="loadingText" class="loading-text" style="margin-top:2rem; min-height:1.5em; font-size:1.2rem;"></div>
        <a href="https://www.sugarlabs.org/" target="_blank" id="link-to-sugarLabs" style="position:fixed; bottom:20px; right:20px;">
            <div class="logo-container" id="bottom-right-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 501 167" height="50" width="150">
                    <!-- Logo paths -->
                    <path d="m63.05 117.52c-11.05 0-21.12-5.5-21.12-11.539 0-3.157 2.303-5.63 5.244-5.63 2.02 0 3.719 1.183 5.515 2.435 2.592 1.809 5.529 3.855 10.651 3.855 5.139 0 8.21-2.647 8.21-5.209 0-3.416-5.271-5.607-10.852-7.927-7.799-3.243-16.639-6.918-16.639-15.886 0-10.573 9.933-16.279 19.28-16.279 7.89 0 18.895 4.132 18.895 10.86 0 2.526-1.763 5.244-5.632 5.244-2.068 0-3.558-1.125-4.997-2.212-1.872-1.414-3.994-3.02-8.266-3.02-1.209 0-7.242.227-7.242 4.726 0 2.729 4.879 4.613 10.04 6.608 7.772 3 17.446 6.739 17.446 16.333.002 12.12-10.646 17.636-20.538 17.636" class="color-change"/>
                    <!-- Additional <path> elements omitted here for brevity -->
                </svg>
            </div>
        </a>
    </div>

    <!-- Primary canvas -->
    <canvas id="canvas" width="1200" height="900" style="background-color:#FFFFFF; width:100%;"></canvas>

    <!-- Hidden at the beginning whilst everything loads -->
    <div id="hideContents" style="display: none;" tabindex="-1">
        <div class="canvasHolder" id="canvasHolder">
            <div class="popupMsg" id="printText" tabindex="-1">
                <div class="contentWrapper">
                    <span id="printTextContent"></span>
                    <img class="msgCloseIcon" onclick="hidePrintText()" src="images/close.svg" alt="Close" >
                </div>
            </div>
            <div class="popupMsg" id="errorText" tabindex="-1">
                <div class="contentWrapper">
                    <span id="errorTextContent"></span>
                    <img class="msgCloseIcon" onclick="hideErrorText()" src="images/close.svg" alt="Close" >
                </div>
            </div>

            <div id="clear-modal-container" style="display: none; z-index: 999; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); align-items: center; justify-content: center;">
                <div id="cleardropdown" style="background-color: white; padding: 24px; border-radius: 8px; width: 400px; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);">
                </div>
            </div>

            <script>
                function hidePrintText() {
                    let printText = document.getElementById("printText");
                    printText.classList.remove("show");
                }

                function hideErrorText() {
                    let errorText = document.getElementById("errorText");
                    errorText.classList.remove("show");
                    hideArrows(); // This function is declared in js/activity.js
                }
            </script>

            <div id="canvasContainer">
                <canvas id="myCanvas" width="1200" height="900"></canvas>
            </div>

            <div style="text-align: center;">
                <div id="load-container">
                    <div id="load-content">
                        <p id="messageText"></p>
                        <amp-img id="loading-image" src="images/loading.gif" alt="Loading..."></amp-img>
                    </div>
                </div>
            </div>

            <canvas id="overlayCanvas" width="1200" height="900" style="position:absolute; pointer-events:none; left:0; top:0; z-index:-100; visibility:hidden;"></canvas>
            <canvas id="myChart" width="600" height="600" tabindex="-1"></canvas>
            <video id="camVideo" style="visibility:hidden;" tabindex="-1"></video>
            <canvas id="camCanvas" style="visibility:hidden;" tabindex="-1"></canvas>
            <div id="languageDiv" tabindex="-1"></div>
            <div id="labelDiv" tabindex="-1"></div>
            <div id="textLabel" tabindex="-1"></div>

            <div id="ioDiv" style="display:none" tabindex="-1">
                <input class="file" type="file" id="myMedia" accept="image/*" tabindex="-1" >
                <input class="file" type="file" id="myOpenFile" accept=".ta, .tb, .html,.mid,.midi" tabindex="-1" >
                <input class="file" type="file" id="myOpenPlugin" accept=".json" tabindex="-1" >
                <input class="file" type="file" id="audio" accept=".mp3, .wav" tabindex="-1" >
                <input class="file" type="file" id="myOpenAll" tabindex="-1" >
            </div>
        </div>
        <!-- canvasHolder -->

        <div tabindex="-1"></div>
        <div id="tourData" tabindex="-1"></div>
        <div id="popdown-palette" tabindex="-1"></div>
        <div id="loader"></div>
        <iframe src="planet/index.html" id="planet-iframe" style="display: none;"></iframe>
        <div id="floatingWindows"></div>
        <div id="helpElem" tabindex="-1"></div>
        <div id="wheelDiv" class="wheelNav" style="background-size: contain; background-image: url(./images/gray.svg)" tabindex="-1"></div>
        <div id="wheelDiv2" class="wheelNav" style="background-size: contain; background-image: url(./images/gray.svg); visibility: hidden" tabindex="-1"></div>
        <div id="meterWheelDiv" class="wheelNav" tabindex="-1"></div>
        <div id="contextWheelDiv" class="wheelNav" tabindex="-1"></div>
        <div id="helpfulWheelDiv" class="wheelNav" style="display: none;" tabindex="-1"></div>
        <div id="submenuWheelDiv" class="wheelNav" tabindex="-1"></div>
        <div id="wheelDivptm" class="wheelNav" style="background-size: contain; background-image: url(./images/gray.svg); display: none; left: 400px; top: 400px;" tabindex="-1"></div>
        <div id="pastecode" tabindex="-1">
            <input type="text" name="paste" id="paste" class="ui-autocomplete" placeholder="Paste Music Blocks code here" style="visibility: hidden" tabindex="-1" >
            <ul class="matches"></ul>
            <input onkeypress="doPaste()" type="submit" value="" tabindex="-1" >
        </div>
        <div id="myProgress" tabindex="-1">
            <div id="myBar" tabindex="-1"></div>
        </div>
        <div id="lilypondModal" class="modal" tabindex="-1">
            <div class="modal-content" tabindex="-1">
                <span class="close">&times;</span>
                <div id="fileNameText"></div>
                <input type="text" id="fileName" tabindex="-1" >
                <p></p>
                <div id="titleText"></div>
                <input type="text" id="title" tabindex="-1" >
                <p></p>
                <div id="authorText"></div>
                <input type="text" id="author" tabindex="-1" >
                <p></p>
                <div id="MIDIText"></div>
                <input type="checkbox" id="MIDICheck" tabindex="-1" >
                <p></p>
                <div id="guitarText"></div>
                <input type="checkbox" id="guitarCheck" tabindex="-1" >
                <p></p>
                <p><button class="confirm-button" id="submitLilypond"></button></p>
            </div>
        </div>

        <div class="materialize-iso" tabindex="-1">
            <nav id="toolbars" class="nav-wrapper" >
                <div class="blue nav-wrapper" tabindex="-1">
                    <div id="mb-logo" class="logo left tooltipped" style="display: flex; align-items: center; line-height: 0; height: 100%; padding-right: 0;" data-position="bottom">
                        <amp-img alt="logo" width="100%" src="images/logo.svg"></amp-img>
                    </div>
                    <ul class="main left">
                        <li><a id="play" class="left tooltipped"><i class="material-icons main">play_circle_filled</i></a></li>
                        <li><a id="stop" class="left tooltipped"><i class="material-icons main">stop</i></a></li>
                        <li><a id="record" class="left tooltipped" data-tooltip="Record"></a></li>
                    </ul>
                    <ul class="main right">
                        <li><a id="FullScreen" class="FullScreen tooltipped dropdown-trigger" data-position="bottom" onclick="setIcon()"><i class="material-icons" id="FullScrIcon">fullscreen</i></a></li>
                        <li><a id="newFile" class="tooltipped dropdown-trigger" data-position="left" data-activates="newdropdown"><i class="material-icons md-48">note_add</i></a></li>
                        <li><a id="load" class="tooltipped" data-position="bottom"><i class="material-icons md-48">folder</i></a></li>
                        <li><a id="saveButton" class="tooltipped dropdown-trigger" data-position="left" data-activates="saveddropdownbeg"><i  class="material-icons md-48">save_alt</i></a></li>
                        <li><a style="display: none;" id="saveButtonAdvanced" class="tooltipped dropdown-trigger" data-position="left" data-activates="saveddropdown"><i  class="material-icons md-48">save_alt</i></a></li>
                        <li><a id="planetIcon" class="tooltipped" data-position="bottom"><i class="material-icons md-48">public</i></a></li>
                        <li><a style="display: none;" id="planetIconDisabled" class="tooltipped" data-position="bottom"><i style="color: #a5acba;" class="material-icons md-48">public</i></a></li>
                        <li><a id="toggleAuxBtn" class="tooltipped" data-position="left"><i id="menu" class="animated-icon material-icons md-48">menu</i></a></li>
                        <li><a id="helpIcon" class="tooltipped" data-position="bottom"><i class="material-icons md-48">help</i></a></li>
                    </ul>
                </div>
                <div class="nav-wrapper" id="aux-toolbar" style="display: none;" tabindex="-1">
                    <div class="blue darken-1 nav-wrapper" tabindex="-1">
                        <ul class="aux left">
                            <li><a id="runSlowlyIcon" class="tooltipped" data-position="bottom" data-delay="10"><i class="material-icons md-48">play_circle_outline</i></a></li>
                            <li><a id="runStepByStepIcon" class="tooltipped" data-position="bottom" data-delay="10"><i class="material-icons md-48">video_library</i></a></li>
                        </ul>
                        <ul class="aux right">
                            <li><a id="displayStatsIcon" class="tooltipped" data-position="bottom" data-delay="10"><i class="material-icons md-48">poll</i></a></li>
                            <li><a id="loadPluginIcon" class="tooltipped" data-position="bottom" data-delay="10"><i class="material-icons md-48">add_circle</i></a></li>
                            <li><a id="delPluginIcon" class="tooltipped" data-position="bottom" data-delay="10"><i class="material-icons md-48">remove_circle</i></a></li>
                            <li><a id="enableHorizScrollIcon" class="tooltipped" data-position="bottom"><i class="material-icons md-48">compare_arrows</i></a></li>
                            <li><a style="display: none;" id="disableHorizScrollIcon" class="tooltipped" data-position="bottom"><i class="material-icons md-48">lock</i></a></li>
                            <li><a id="themeSelectIcon" class="tooltipped dropdown-trigger" data-position="left" data-activates="themedropdown" data-tooltip="Select Theme"><i class="material-icons md-48">brightness_7</i></a></li>
                            <li><a id="mergeWithCurrentIcon" class="tooltipped" data-position="bottom"><i class="material-icons md-48">merge_type</i></a></li>
                            <li><a id="wrapTurtle" class="tooltipped" data-position="bottom"><i class="material-icons md-48">wrap_text</i></a></li>
                            <li><a id="chooseKeyIcon" class="tooltipped" data-position="left"><i class="material-icons md-48">music_note</i></a></li>
                            <li><a id="toggleJavaScriptIcon" class="tooltipped" data-position="bottom"><i class="material-icons md-48">code</i></a></li>
                            <li class="filler" id="aligns_merge_under_load" style="user-select: none; visibility: hidden;"><a style="color: transparent;">space&nbsp;&nbsp;&nbsp;</a></li>
                            <li><a id="restoreIcon" class="tooltipped" data-position="bottom" data-tooltip="Restore"><i class="material-icons md-48">restore_from_trash</i></a><div id="trashList"></div></li>
                            <li><a id="beginnerMode" class="tooltipped" data-position="bottom"><i id="begIconText" class="material-icons md-48">star</i></a></li>
                            <li><a id="advancedMode" class="tooltipped" data-position="bottom"><i id="advIconText" class="material-icons md-48">star_border</i></a></li>
                            <li><a id="languageSelectIcon" class="tooltipped dropdown-trigger" data-position="left" data-activates="languagedropdown" data-tooltip="Select Language"><i class="material-icons md-48">translate</i></a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            <ul id="saveddropdownbeg" class="dropdown-content">
                <li><a id="save-html-beg"></a></li>
                <li><a id="save-png-beg"></a></li>
            </ul>
            <ul id="saveddropdown" class="dropdown-content">
                <li><a id="save-html"></a></li>
                <li><a id="save-midi"></a></li>
                <li><a id="save-svg"></a></li>
                <li><a id="save-png"></a></li>
                <li><a id="save-wav"></a></li>
                <li><a id="save-abc"></a></li>
                <li><a id="save-ly"></a></li>
                <li><a id="save-mxml"></a></li>
                <li><a id="save-blockartwork-svg"></a></li>
                <li><a id="save-blockartwork-png"></a></li>
            </ul>
            <ul id="languagedropdown" class="dropdown-content">
                <li><a id="enUS"></a></li>
                <li><a id="enUK"></a></li>
                <li><a id="es"></a></li>
                <li><a id="pt"></a></li>
                <li><a id="ja"></a></li>
                <li><a id="kana"></a></li>
                <li><a id="ko"></a></li>
                <li><a id="zhCN"></a></li>
                <li><a id="th"></a></li>
                <li><a id="ayc"></a></li>
                <li><a id="quz"></a></li>
                <li><a id="gug"></a></li>
                <li><a id="hi"></a></li>
                <li><a id="te"></a></li>
                <li><a id="ibo"></a></li>
                <li><a id="ar"></a></li>
                <li><a id="he"></a></li>
                <li><a id="ur"></a></li>
            </ul>
            <ul style="display: none;" id="themedropdown" class="dropdown-content">
                <li><a id="light" class="tooltipped" data-tooltip="Light Mode"><i class='material-icons'>brightness_7</i></a></li>
                <li><a id="dark" class="tooltipped" data-tooltip="Dark Mode"><i class='material-icons'>brightness_4</i></a></li>
            </ul>
            <div id="modal-container" style="display: none; z-index: 999;">
                <ul id="newdropdown" class="dropdown-content" style="padding: 24px;"></ul>
            </div>

            <script>
                var elem = document.documentElement;
                function openFullscreen() {
                    if (elem.requestFullscreen) {
                        elem.requestFullscreen();
                    } else if (elem.webkitRequestFullscreen) {
                        elem.webkitRequestFullscreen();
                    } else if (elem.msRequestFullscreen) {
                        elem.msRequestFullscreen();
                    } else if (elem.mozRequestFullscreen) {
                        elem.mozRequestFullscreen();
                    }
                }

                function closeFullscreen() {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    } else if (document.mozExitFullscreen) {
                        document.mozExitFullscreen();
                    }
                }
                var count = 0;
                function setIcon() {
                    var iconCode = document.querySelector('#FullScrIcon');
                    if (count == 0) {
                        openFullscreen();
                        iconCode.textContent = '\ue5d1';
                        count = 1;
                    } else {
                        closeFullscreen();
                        iconCode.textContent = '\ue5d0';
                        count = 0;
                    }
                }
                document.addEventListener('fullscreenchange', handleFullscreenChange);
                document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
                document.addEventListener('mozfullscreenchange', handleFullscreenChange);
                document.addEventListener('MSFullscreenChange', handleFullscreenChange);

                function handleFullscreenChange() {
                    var iconCode = document.querySelector('#FullScrIcon');
                    count = document.fullscreenElement ? 1 : 0;
                    iconCode.textContent = count ? '\ue5d1' : '\ue5d0';
                }
            </script>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let persistentNotification = null;

            function showPersistentNotification() {
                if (!persistentNotification) {
                    persistentNotification = document.createElement("div");
                    persistentNotification.id = "persistentNotification";
                    persistentNotification.innerHTML = "Play only mode enabled. For full Music Blocks experience, use a larger display.";
                    document.body.appendChild(persistentNotification);
                }
            }

            function removePersistentNotification() {
                if (persistentNotification) {
                    persistentNotification.remove();
                    persistentNotification = null;
                }
            }

            function hideElementById(elementId) {
                const elem = document.getElementById(elementId);
                if (elem) elem.style.display = "none";
            }

            function showElementById(elementId) {
                const elem = document.getElementById(elementId);
                if (elem) elem.style.display = "";
            }

            function togglePlayOnlyMode() {
                const isSmallScreen = (window.innerWidth < 768) || (window.innerHeight < 600);
                const body = document.body;
                const homeButton = document.getElementById("Home [HOME]");
                const buttonContainer = document.getElementById("buttoncontainerBOTTOM");

                if (isSmallScreen) {
                    body.classList.add("play-only");
                    showPersistentNotification();
                    if (buttonContainer) {
                        buttonContainer.style.display = "flex";
                        buttonContainer.style.justifyContent = "flex-end";
                        buttonContainer.style.alignItems = "center";
                    }
                    if (homeButton) {
                        homeButton.style.display = "flex";
                        homeButton.style.position = "fixed";
                        homeButton.style.right = "15px";
                        homeButton.style.bottom = "15px";
                        homeButton.style.zIndex = "10000";
                    }
                    hideElementById("Show/hide blocks");
                    hideElementById("Expand/collapse blocks");
                    hideElementById("Decrease block size");
                    hideElementById("Increase block size");
                    hideElementById("grid");
                    hideElementById("palette");
                } else {
                    body.classList.remove("play-only");
                    removePersistentNotification();
                    if (homeButton) homeButton.style = "";
                    if (buttonContainer) buttonContainer.style = "";
                    showElementById("Show/hide blocks");
                    showElementById("Expand/collapse blocks");
                    showElementById("Decrease block size");
                    showElementById("Increase block size");
                    showElementById("grid");
                    showElementById("palette");
                }
            }

            togglePlayOnlyMode();
            window.addEventListener("resize", togglePlayOnlyMode);
        });
    </script>

    <div id="searchBar" tabindex="-1">
        <input type="text" name="search" id="search" class="ui-autocomplete" placeholder="Search for Blocks" tabindex="-1" >
        <ul class="matches" id="searchResults"></ul>
    </div>

</body>
</html>
